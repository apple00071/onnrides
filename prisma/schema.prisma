generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
  previewFeatures = ["driverAdapters"]
  binaryTargets = ["native", "debian-openssl-3.0.x", "rhel-openssl-3.0.x", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminNotification {
  id         String   @id
  type       String
  title      String
  recipient  String
  channel    String
  status     String
  error      String?
  data       String?
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([created_at])
  @@index([recipient, channel])
  @@index([type, status])
}

model DeliveryBooking {
  id                  String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  delivery_partner_id String             @db.Uuid
  booking_id          String             @unique @db.Uuid
  pickup_location     Json
  dropoff_location    Json
  status              String             @default("pending")
  estimated_distance  Float              @db.Real
  estimated_duration  Int
  actual_duration     Int?
  price               Float              @db.Real
  created_at          DateTime           @default(now()) @db.Timestamp(6)
  updated_at          DateTime           @default(now()) @db.Timestamp(6)
  bookings            bookings           @relation(fields: [booking_id], references: [id])
  DeliveryPartner     DeliveryPartner    @relation(fields: [delivery_partner_id], references: [id])
  DeliveryTracking    DeliveryTracking[]

  @@index([booking_id], map: "idx_delivery_booking_booking")
  @@index([delivery_partner_id], map: "idx_delivery_booking_partner")
  @@index([status], map: "idx_delivery_booking_status")
}

model DeliveryPartner {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String            @db.Uuid
  vehicle_type     String
  vehicle_number   String
  license_number   String
  is_available     Boolean           @default(true)
  current_location Json?
  rating           Float             @default(0) @db.Real
  total_trips      Int               @default(0)
  created_at       DateTime          @default(now()) @db.Timestamp(6)
  updated_at       DateTime          @default(now()) @db.Timestamp(6)
  DeliveryBooking  DeliveryBooking[]
  users            users             @relation(fields: [user_id], references: [id])

  @@index([is_available], map: "idx_delivery_partner_availability")
  @@index([rating], map: "idx_delivery_partner_rating")
}

model DeliveryTracking {
  id                  String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  delivery_booking_id String          @db.Uuid
  location            Json
  timestamp           DateTime        @default(now()) @db.Timestamp(6)
  status              String
  notes               String?
  DeliveryBooking     DeliveryBooking @relation(fields: [delivery_booking_id], references: [id])

  @@index([delivery_booking_id, timestamp], map: "idx_delivery_tracking_booking_time")
}

model booking_history {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  booking_id String   @db.Uuid
  action     String
  details    String
  created_by String
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  bookings   bookings @relation(fields: [booking_id], references: [id], onDelete: Cascade)

  @@index([booking_id], map: "idx_booking_history_booking_id")
  @@index([created_at], map: "idx_booking_history_created_at")
}

model bookings {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String            @db.Uuid
  vehicle_id        String            @db.Uuid
  start_date        DateTime          @db.Timestamp(6)
  end_date          DateTime          @db.Timestamp(6)
  total_hours       Float             @db.Real
  total_price       Float             @db.Real
  status            String?           @default("pending")
  payment_status    String?           @default("pending")
  payment_details   String?
  created_at        DateTime?         @default(now()) @db.Timestamp(6)
  updated_at        DateTime?         @default(now()) @db.Timestamp(6)
  pickup_location   String?
  dropoff_location  String?
  booking_id        String?
  payment_intent_id String?           @unique
  DeliveryBooking   DeliveryBooking?
  booking_history   booking_history[]
  users             users             @relation(fields: [user_id], references: [id])
  vehicles          vehicles          @relation(fields: [vehicle_id], references: [id])
  trip_initiations  trip_initiations?

  @@index([payment_status], map: "idx_booking_payment_status")
  @@index([user_id, status], map: "idx_booking_user_status")
  @@index([vehicle_id, start_date, end_date], map: "idx_booking_vehicle_dates")
  @@index([payment_intent_id], map: "idx_bookings_payment_intent_id")
}

model coupons {
  id                  String    @id
  code                String    @unique
  description         String?
  discount_type       String
  discount_value      Decimal   @db.Decimal(10, 2)
  min_booking_amount  Decimal?  @db.Decimal(10, 2)
  max_discount_amount Decimal?  @db.Decimal(10, 2)
  start_date          DateTime? @db.Timestamp(6)
  end_date            DateTime? @db.Timestamp(6)
  usage_limit         Int?
  times_used          Int?      @default(0)
  is_active           Boolean?  @default(true)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)

  @@index([code], map: "idx_coupons_code")
  @@index([is_active], map: "idx_coupons_is_active")
}

model document_submissions {
  id             Int       @id @default(autoincrement())
  user_id        Int?
  document_type  String    @db.VarChar(50)
  document_url   String
  status         String?   @default("pending") @db.VarChar(50)
  admin_comments String?
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @db.Timestamptz(6)
}

model documents {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String    @db.Uuid
  type             String
  status           String?   @default("pending")
  file_url         String
  rejection_reason String?
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
}

model email_logs {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  recipient       String
  subject         String
  message_content String
  status          String
  error           String?
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@index([recipient], map: "idx_email_logs_recipient")
  @@index([status], map: "idx_email_logs_status")
}

model locations {
  id         String    @id
  name       String    @db.VarChar(255)
  address    String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

model payments {
  id             Int       @id @default(autoincrement())
  booking_id     Int?
  user_id        Int?
  amount         Decimal   @db.Decimal
  payment_method String?   @db.VarChar(50)
  transaction_id String?   @db.VarChar(255)
  status         String?   @default("pending") @db.VarChar(50)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @db.Timestamptz(6)
}

model profiles {
  id         String    @id
  user_id    String?
  name       String?   @db.VarChar(255)
  phone      String?   @db.VarChar(50)
  avatar_url String?
  address    String?
  city       String?   @db.VarChar(100)
  state      String?   @db.VarChar(100)
  country    String?   @db.VarChar(100)
  zip_code   String?   @db.VarChar(20)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

model reviews {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  vehicle_id Int?
  booking_id Int?
  rating     Int
  comment    String?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

model settings {
  id         String   @id
  key        String   @unique
  value      String
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  @@index([key], map: "idx_settings_key")
}

model sms_logs {
  id           String   @id
  phone_number String
  message      String
  status       String   @default("pending")
  created_at   DateTime @default(now())
  updated_at   DateTime
}

model trip_initiations {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  booking_id              String   @unique @db.Uuid
  checklist_completed     Boolean  @default(false)
  customer_name           String
  customer_phone          String
  customer_email          String?
  customer_dl_number      String?
  customer_address        String?
  emergency_contact       String?
  emergency_name          String?
  customer_aadhaar_number String?
  customer_dob            String?
  vehicle_number          String?
  documents               Json?
  terms_accepted          Boolean  @default(false)
  notes                   String?
  created_at              DateTime @default(now()) @db.Timestamp(6)
  updated_at              DateTime @default(now()) @db.Timestamp(6)
  bookings                bookings @relation(fields: [booking_id], references: [id])
}

model users {
  id                 String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name               String?
  email              String?           @unique(map: "users_email_unique")
  password_hash      String?
  phone              String?
  reset_token        String?
  reset_token_expiry DateTime?         @db.Timestamp(6)
  is_blocked         Boolean?          @default(false)
  role               String?           @default("user")
  created_at         DateTime?         @default(now()) @db.Timestamp(6)
  updated_at         DateTime?         @default(now()) @db.Timestamp(6)
  DeliveryPartner    DeliveryPartner[]
  bookings           bookings[]

  @@index([email], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model users_backup {
  id                 String?   @db.Uuid
  name               String?
  email              String?
  password_hash      String?
  phone              String?
  reset_token        String?
  reset_token_expiry DateTime? @db.Timestamp(6)
  is_blocked         Boolean?
  role               String?
  created_at         DateTime? @db.Timestamp(6)
  updated_at         DateTime? @db.Timestamp(6)

  @@ignore
}

model vehicles {
  id                     String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String
  type                   String
  location               String
  quantity               Int
  price_per_hour         Float      @db.Real
  min_booking_hours      Int
  is_available           Boolean?   @default(true)
  images                 String
  status                 String?    @default("active")
  created_at             DateTime?  @default(now()) @db.Timestamp(6)
  updated_at             DateTime?  @default(now()) @db.Timestamp(6)
  price_15_days          Float?     @db.Real
  price_30_days          Float?     @db.Real
  price_7_days           Float?     @db.Real
  delivery_price_15_days Float?     @db.Real
  delivery_price_30_days Float?     @db.Real
  delivery_price_7_days  Float?     @db.Real
  vehicle_category       String     @default("normal") @db.VarChar(10)
  bookings               bookings[]

  @@index([vehicle_category], map: "idx_vehicle_category")
  @@index([location, type], map: "idx_vehicle_location_type")
  @@index([status, is_available], map: "idx_vehicle_status_availability")
  @@index([updated_at], map: "idx_vehicle_updated_at")
}

enum vehicle_status {
  active
  maintenance
  retired
}
